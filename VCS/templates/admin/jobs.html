{% extends 'base.html' %}
{% block content %}

<div class="mt-6">
    <a href="{% url 'admin_dashboard' %}" class="text-blue-600 hover:underline">
        ‚Üê Back to Dashboard
    </a>
</div>

<h1 class="text-2xl font-bold mb-6">üíº Admin Job Management</h1>

<!-- SEARCH + ADD -->
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6">

<form method="get" class="flex gap-2 w-full md:w-1/2">
    <input name="q" value="{{ request.GET.q }}" placeholder="Search job..."
           class="border px-4 py-2 rounded w-full">

    <button type="submit"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Search
    </button>

    {% if request.GET.q %}
        <a href="{% url 'admin_jobs' %}"
           class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">
            Clear
        </a>
    {% endif %}
</form>

<button type="button" onclick="openAddModal()" 
class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
‚ûï Add Job
</button>

</div>

<!-- TABLE -->
<div class="overflow-x-auto">
<table class="w-full bg-white shadow rounded">
<thead class="bg-gray-100">
<tr>
    <th class="p-3">Title</th>
    <th>Company</th>
    <th>Location</th>
    <th>Experience</th>
    <th>Salary</th>
    <th>Remote</th>
    <th>Actions</th>
</tr>
</thead>

<tbody>
{% for job in jobs %}
<tr class="border-t text-center hover:bg-gray-50">
    <td class="p-2">{{ job.job_title }}</td>
    <td>{{ job.company_name }}</td>
    <td>{{ job.location }}</td>
    <td>{{ job.experience }}</td>
    <td>‚Çπ{{ job.salary_range }}</td>
    <td>{% if job.is_remote %}‚úÖ{% else %}‚ùå{% endif %}</td>
    <td class="space-x-2">
        <button type="button"
        onclick="openEditModal(
        '{{ job.id }}',
        '{{ job.job_title|escapejs }}',
        '{{ job.company_name|escapejs }}',
        '{{ job.location|escapejs }}',
        '{{ job.experience }}',
        '{{ job.salary_range }}',
        '{{ job.is_remote }}',
        '{{ job.eligibility|escapejs }}',
        '{{ job.job_description|escapejs }}')"
        class="text-blue-600 hover:underline">
        Edit
        </button>

        <a href="{% url 'delete_job' job.id %}"
           onclick="return confirm('Delete this job?')"
           class="text-red-600 hover:underline">
           Delete
        </a>
    </td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

<!-- ================= ADD MODAL ================= -->

<div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
<div class="bg-white rounded-xl shadow-xl w-[550px] max-h-[90vh] overflow-y-auto">

<div class="bg-green-600 text-white p-3">
    <h2 class="text-lg font-bold">‚ûï Add New Job</h2>
</div>

<form method="post" action="{% url 'add_job' %}" class="p-4 space-y-3">
{% csrf_token %}

<input name="job_title" placeholder="Job Title" required class="w-full border p-2 rounded">
<input name="company_name" placeholder="Company Name" required class="w-full border p-2 rounded">
<input name="location" placeholder="Location" required class="w-full border p-2 rounded">

<select name="experience" required class="w-full border p-2 rounded">
<option value="">Select Experience</option>
<option value="FRESHER">Fresher</option>
<option value="1-3">1-3 Years</option>
<option value="3-5">3-5 Years</option>
<option value="5+">5+ Years</option>
</select>

<input name="salary_range" type="number" placeholder="Salary (Monthly)" required class="w-full border p-2 rounded">

<label class="flex items-center gap-2">
<input type="checkbox" name="is_remote"> Remote Job
</label>

<textarea name="eligibility" rows="2" placeholder="Eligibility" class="w-full border p-2 rounded"></textarea>
<textarea name="job_description" rows="3" placeholder="Job Description" class="w-full border p-2 rounded"></textarea>

<div class="flex justify-end gap-3">
<button type="button" onclick="closeAddModal()" class="border px-4 py-1 rounded">Cancel</button>
<button class="bg-green-600 text-white px-4 py-1 rounded hover:bg-green-700">Save</button>
</div>

</form>
</div>
</div>

<!-- ================= EDIT MODAL ================= -->

<div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
<div class="bg-white rounded-xl shadow-xl w-[550px] max-h-[90vh] overflow-y-auto p-4">

<h2 class="text-lg font-bold mb-3">‚úèÔ∏è Edit Job</h2>

<form method="post" id="editForm" class="space-y-3">
{% csrf_token %}

<input id="edit_title" name="job_title" class="w-full border p-2 rounded">
<input id="edit_company" name="company_name" class="w-full border p-2 rounded">
<input id="edit_location" name="location" class="w-full border p-2 rounded">

<select id="edit_experience" name="experience" class="w-full border p-2 rounded">
<option value="FRESHER">Fresher</option>
<option value="1-3">1-3 Years</option>
<option value="3-5">3-5 Years</option>
<option value="5+">5+ Years</option>
</select>

<input id="edit_salary" name="salary_range" type="number" class="w-full border p-2 rounded">

<label class="flex items-center gap-2">
<input type="checkbox" id="edit_remote" name="is_remote"> Remote Job
</label>

<textarea id="edit_eligibility" name="eligibility" rows="2" class="w-full border p-2 rounded"></textarea>
<textarea id="edit_description" name="job_description" rows="3" class="w-full border p-2 rounded"></textarea>

<div class="flex justify-end gap-3">
<button type="button" onclick="closeEditModal()" class="border px-4 py-1 rounded">Cancel</button>
<button class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">Update</button>
</div>

</form>
</div>
</div>

<script>
function openAddModal(){
    document.getElementById('addModal').classList.remove('hidden');
}
function closeAddModal(){
    document.getElementById('addModal').classList.add('hidden');
}

function openEditModal(id,title,company,location,experience,salary,is_remote,eligibility,description){
    document.getElementById('editModal').classList.remove('hidden');

    document.getElementById('edit_title').value = title;
    document.getElementById('edit_company').value = company;
    document.getElementById('edit_location').value = location;
    document.getElementById('edit_experience').value = experience;
    document.getElementById('edit_salary').value = salary;
    document.getElementById('edit_eligibility').value = eligibility;
    document.getElementById('edit_description').value = description;

    document.getElementById('edit_remote').checked = (is_remote === "True");

    document.getElementById('editForm').action = "/dashboard/jobs/edit/" + id + "/";
}

function closeEditModal(){
    document.getElementById('editModal').classList.add('hidden');
}
</script>

{% endblock %}

{% extends 'base.html' %}
{% block content %}

<!-- Boxicons CDN -->
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

<div class="max-w-6xl min-h-screen bg-gray-200 mx-auto px-4 py-6">

  <!-- Back Button -->
  <div class="mt-6">
    <a href="{% url 'admin_candidates' %}" 
       class="text-blue-600 hover:underline flex items-center gap-2">
      <i class='bx bx-left-arrow-alt'></i> Back to Candidates
    </a>
  </div>

  <!-- Header -->
  <h1 class="text-2xl font-bold mb-6 text-blue-600 flex items-center gap-2">
    <i class='bx bx-user-circle'></i> Candidate Profile
  </h1>

  <!-- PROFILE CARD -->
  <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 grid md:grid-cols-2 gap-6">

    <!-- Left Column: Info & Skills -->
    <div>
      <h2 class="text-2xl font-semibold mb-1 text-red-800">
        {{ profile.user.first_name }} {{ profile.user.last_name }}
      </h2>
      <p class="text-red-500 text-2xl flex items-center gap-1"><i class='bx bx-user'></i> -{{ profile.user.username }}</p>

      <div class="mt-4 space-y-1 text-gray-700">
        <p class="flex items-center gap-1"><i class='bx bx-envelope'></i> <strong>Email:</strong> {{ profile.user.email }}</p>
        <p class="flex items-center gap-1"><i class='bx bx-map'></i> <strong>Location:</strong> {{ profile.location }}</p>
        <p class="flex items-center gap-1"><i class='bx bx-briefcase'></i> <strong>Experience:</strong> {{ profile.experience }}</p>
      </div>

      <p class="mt-4 font-semibold text-gray-800 flex items-center gap-1"><i class='bx bx-atom'></i> Skills:</p>
      <div class="flex flex-wrap gap-2 mt-2">
        {% for skill in skills_list %}
          <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">
            {{ skill }}
          </span>
        {% empty %}
          <span class="text-gray-500">No skills added</span>
        {% endfor %}
      </div>

      {% if profile.resume %}
      <a href="{{ profile.resume.url }}" target="_blank"
         class="inline-block mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow-md flex items-center gap-2">
        <i class='bx bx-file'></i> Download Resume
      </a>
      {% endif %}
    </div>

    <!-- Right Column: Summary -->
    <div class="bg-gray-50 p-6 rounded-lg flex flex-col  shadow-inner">
      <h3 class="font-semibold text-lg flex items-center gap-2 text-gray-800">
        <i class='bx bx-bar-chart-alt-2'></i> Profile Summary
      </h3>
      <p class=""><strong>Total Applications:</strong> {{ applications.count }}</p>

      <p class=""><strong>Status:</strong>
        {% if profile.resume %}
          <span class="text-green-600 font-semibold">Profile Complete</span>
        {% else %}
          <span class="text-red-600 font-semibold">Incomplete</span>
        {% endif %}
      </p>
    </div>

  </div>

  <!-- APPLICATIONS TABLE -->
  <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 text-gray-800">
    <i class='bx bx-briefcase'></i> Applications
  </h2>

  <div class="overflow-x-auto bg-white rounded-2xl shadow-lg mb-8">
    <table class="min-w-full text-sm divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-3 text-left font-medium text-gray-700">Job</th>
          <th class="p-3 font-medium text-gray-700">Status</th>
          <th class="p-3 font-medium text-gray-700">Applied On</th>
          <th class="p-3 font-medium text-gray-700">Action</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-200">
        {% for app in applications %}
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="p-3">
            <div class="font-semibold text-gray-800">{{ app.job.job_title }}</div>
            <div class="text-gray-500 text-sm flex items-center gap-1"><i class='bx bx-building'></i> {{ app.job.company_name }}</div>
          </td>

          <td class="p-3 text-center">
            <span class="px-3 py-1 rounded-full text-xs font-semibold
              {% if app.status == 'HIRED' %}bg-green-100 text-green-700
              {% elif app.status == 'REJECTED' %}bg-red-100 text-red-700
              {% elif app.status == 'WAITING' %}bg-purple-100 text-purple-700
              {% else %}bg-blue-100 text-blue-700{% endif %}">
              {{ app.status }}
            </span>
          </td>

          <td class="p-3 text-center text-gray-700">{{ app.applied_at|date:"d M Y" }}</td>

          <td class="p-3 text-center">
            <a href="{% url 'schedule_interview' app.id %}"
               class="text-blue-600 hover:underline font-semibold flex items-center gap-1 justify-center">
              <i class='bx bx-calendar-plus'></i> Schedule Interview
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="p-4 text-center text-gray-500">
            No applications found.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- INTERACTION HISTORY -->
  <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 text-gray-800">
    <i class='bx bx-chat'></i> Interaction History
  </h2>

  <div class="space-y-4">
    {% for interaction in interactions %}
    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-600">
      <p class="text-gray-700">{{ interaction.message }}</p>
      <span class="text-sm text-gray-500 flex items-center gap-1">
        <i class='bx bx-time-five'></i> {{ interaction.created_at|date:"d M Y H:i" }} by {{ interaction.admin.username }}
      </span>
    </div>
    {% empty %}
    <p class="text-gray-500">No interactions yet.</p>
    {% endfor %}
  </div>

</div>

{% endblock %}
